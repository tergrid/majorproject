/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import e from"../../../../Graphic.js";import{Tiles3DTarget as i}from"../i3s/Intersector.js";import{newIntersectorResult as t}from"../../webgl-engine/lib/Intersector.js";import{IntersectorType as r,StoreResults as s}from"../../webgl-engine/lib/IntersectorInterfaces.js";class n{constructor(e){this.layerUid=[],this.type=r.TILES3D,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerView=e,this.layerUid.push(e.layer.uid)}intersect(e,r,n,l){const o=e.results,a=e.options.store===s.ALL;if(e.options.filteredLayerUids.includes(this.layerView.layer.uid))return;const c=this.layerView.view._stage.renderView.componentObjectCollection;this.layerView.objects.forEach((s=>{s.visible&&s.intersectionGeometry&&c.intersect(s,n,l,e.tolerance,null,((s,c,u,d)=>{if(c>=0){if(null!=r&&!r(n,l,c))return;const s=e=>{const t=new i(this.layerView.layer.uid,(()=>this._createTiles3DGraphic(this.layerView.layer,{})));e.set(this.type,t,c,u)};if(this.isGround&&(null==o.ground.dist||c<o.ground.dist)&&s(o.ground),e.options.isFiltered)return;if((null==o.min.dist||c<o.min.dist)&&s(o.min),(null==o.max.dist||c>o.max.dist)&&s(o.max),a){const i=t(e.ray);s(i),e.results.all.push(i)}}}))}))}_createTiles3DGraphic(i,t){return new e({layer:i,sourceLayer:i,attributes:t})}}export{n as Tiles3DIntersectionHandler};
