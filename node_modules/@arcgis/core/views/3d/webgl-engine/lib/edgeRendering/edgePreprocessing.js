/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{range as e}from"../../../../../core/arrayUtils.js";import{deg2rad as t,acosClamped as n}from"../../../../../core/mathUtils.js";import{q as o,s as r,c,k as s,E as a,b as i,f as l,n as f}from"../../../../../chunks/vec32.js";import{create as g}from"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js";const m=-1;var p;function u(n,a,i,l=E){const f=n.vertices.position,g=n.vertices.componentIndex,p=t(l.anglePlanar),u=t(l.angleSignificantEdge),y=Math.cos(u),V=Math.cos(p),x=I.edge,N=x.position0,S=x.position1,j=x.faceNormal0,D=x.faceNormal1,F=w(n),b=d(n),L=b.length/4,k=a.allocate(L);let C=0;const H=L,K=i.allocate(H);let M=0,O=0,P=0;const T=e(0,L),U=new Float32Array(L);U.forEach(((e,t,n)=>{f.getVec(b[4*t],N),f.getVec(b[4*t+1],S),n[t]=o(N,S)})),T.sort(((e,t)=>U[t]-U[e]));const q=new Array,z=new Array;for(let e=0;e<L;e++){const t=T[e],n=U[t],o=b[4*t],l=b[4*t+1],u=b[4*t+2],d=b[4*t+3],w=d===m;if(f.getVec(o,N),f.getVec(l,S),w)r(j,F[3*u],F[3*u+1],F[3*u+2]),c(D,j),x.componentIndex=g.get(o),x.cosAngle=s(j,D);else{if(r(j,F[3*u],F[3*u+1],F[3*u+2]),r(D,F[3*d],F[3*d+1],F[3*d+2]),x.componentIndex=g.get(o),x.cosAngle=s(j,D),v(x,V))continue;x.cosAngle<-.9999&&c(D,j)}O+=n,P++,w||h(x,y)?(a.write(k,C++,x),q.push(n)):A(x,p)&&(i.write(K,M++,x),z.push(n))}const B=new Float32Array(q.reverse()),G=new Float32Array(z.reverse());return{regular:{instancesData:a.trim(k,C),lodInfo:{lengths:B}},silhouette:{instancesData:i.trim(K,M),lodInfo:{lengths:G}},averageEdgeLength:O/P}}function h(e,t){return e.cosAngle<t}function v(e,t){return e.cosAngle>t}function A(e,t){const o=n(e.cosAngle),r=I.fwd,c=I.ortho;a(r,e.position1,e.position0);return o*(s(i(c,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function d(e){const t=e.faces.length/3,n=e.faces,o=e.neighbors;let r=0;for(let a=0;a<t;a++){const e=o[3*a],t=o[3*a+1],c=o[3*a+2],s=n[3*a],i=n[3*a+1],l=n[3*a+2];r+=e===m||s<i?1:0,r+=t===m||i<l?1:0,r+=c===m||l<s?1:0}const c=new Int32Array(4*r);let s=0;for(let a=0;a<t;a++){const e=o[3*a],t=o[3*a+1],r=o[3*a+2],i=n[3*a],l=n[3*a+1],f=n[3*a+2];(e===m||i<l)&&(c[s++]=i,c[s++]=l,c[s++]=a,c[s++]=e),(t===m||l<f)&&(c[s++]=l,c[s++]=f,c[s++]=a,c[s++]=t),(r===m||f<i)&&(c[s++]=f,c[s++]=i,c[s++]=a,c[s++]=r)}return c}function w(e){const t=e.faces.length/3,n=e.vertices.position,o=e.faces,r=y.v0,c=y.v1,s=y.v2,a=new Float32Array(3*t);for(let g=0;g<t;g++){const e=o[3*g],t=o[3*g+1],m=o[3*g+2];n.getVec(e,r),n.getVec(t,c),n.getVec(m,s),l(c,c,r),l(s,s,r),i(r,c,s),f(r,r),a[3*g]=r[0],a[3*g+1]=r[1],a[3*g+2]=r[2]}return a}!function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"}(p||(p={}));const I={edge:{position0:g(),position1:g(),faceNormal0:g(),faceNormal1:g(),componentIndex:0,cosAngle:0},ortho:g(),fwd:g()},y={v0:g(),v1:g(),v2:g()},E={anglePlanar:4,angleSignificantEdge:35};export{p as EdgeType,u as extractEdges};
