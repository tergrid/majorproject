/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as t}from"../../../../chunks/tslib.es6.js";import{watch as e}from"../../../../core/reactiveUtils.js";import{waitAnimationFrame as i}from"../../../../core/scheduling.js";import{property as n}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as o}from"../../../../core/accessorSupport/decorators/subclass.js";import{tooltipKeys as s}from"../../keybindings.js";import{base as l}from"../css.js";import a from"../../../../widgets/Widget.js";import{loadCalciteComponents as c}from"../../../../widgets/support/componentsUtils.js";import"../../../../widgets/support/widgetUtils.js";import{tsx as r}from"../../../../widgets/support/jsxFactory.js";const u=`${l}-editable-field`,p={base:u,inputMode:`${u}--input`,locked:`${u}--locked`,title:`${u}__title`,titleContent:`${u}__title__content`,value:`${u}__value`,valueContent:`${u}__value__content`,valueContentReadOnly:`${u}__value__content--read-only`,input:`${u}__input`,inputSuffix:`${u}__input-suffix`,button:`${u}__button`};let d=class extends a{constructor(){super(...arguments),this._input=null,this._selectText=()=>{const t=()=>{this._input===document.activeElement&&this._input?.selectText()};t(),i().then(t)},this._onKeyDown=t=>{t.key===s.discard&&this._discard()},this._onInputKeyDown=t=>{switch(t.key){case s.commit:return this._commit({type:"commit-and-exit",allowLockingCurrentValue:!0});case s.next:return t.preventDefault(),t.stopPropagation(),this._commit({type:t.shiftKey?"commit-and-previous":"commit-and-next",allowLockingCurrentValue:!1})}},this._onInput=t=>{this.field.inputValue=t.target.value},this._onLockClick=()=>{const{field:t}=this;t.locked?t.unlock():this._lock()}}initialize(){this.addHandles(e((()=>this._rawDisplayValue),(()=>{const{committed:t,inputValue:e}=this.field;t||e||this._input!==document.activeElement||this._selectText()})))}loadDependencies(){return c({action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),input:()=>import("@esri/calcite-components/dist/components/calcite-input.js")})}render(){const{mode:t,field:e}=this,i="input"===t,{locked:n}=e;return r("div",{class:this.classes({[p.base]:!0,[p.inputMode]:"input"===t,[p.locked]:n})},r("div",{class:p.title,key:"title"},r("div",{class:p.titleContent,key:"title-content"},this._title,n&&!i?r("calcite-icon",{icon:"lock",key:"icon",scale:"s"}):null)),r("div",{class:p.value,key:"value"},i?this._renderInputModeValue():this._renderFeedbackModeValue()))}get _initialValue(){const{field:t}=this;return null!=t.actual?t.toInputUnits(t.actual,this.context).value:null}get _formattedValue(){const{context:t,field:e}=this,{actual:i,committed:n,format:o}=e;return null!=n?o(n,t):null!=i?o(i,t):_}get _rawDisplayValue(){const{field:t}=this,{inputValue:e,committed:i}=t;return null!=e?e:this._toString(null!=i?t.toInputUnits(i,this.context).value:this._initialValue)}get _suffix(){const{suffix:t}=this.field;return"string"==typeof t?t:t(this.context)}get _title(){const{title:t}=this.field;return"string"==typeof t?t:t(this.context)}_renderFeedbackModeValue(){return r("span",{key:"value-feedback"},this._formattedValue)}_renderInputModeValue(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return r("span",{class:p.valueContentReadOnly,key:"value-readonly"},this._formattedValue)}_renderValueWritable(){const{locked:t,name:e}=this.field,i=this.context?.messages.sketch??{},n=t?i.unlockConstraint:i.lockConstraint;return r("div",{class:p.valueContent,key:"value-writable",onkeydown:this._onKeyDown},r("calcite-input",{afterCreate:t=>{this._input=t},class:p.input,"data-field-name":e,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",type:"text",value:this._rawDisplayValue,onCalciteInputInput:this._onInput}),r("div",{class:p.inputSuffix,key:"suffix"},this._suffix),r("calcite-action",{alignment:"center",appearance:"transparent",class:p.button,compact:!0,icon:t?"lock":"unlock",label:n,onclick:this._onLockClick,scale:"s",tabIndex:-1,text:"",title:n}))}_commit({type:t,allowLockingCurrentValue:e}){const{_input:i,field:n}=this;if(!i)return;const{locked:o,inputValue:s}=n;o&&""===s?n.unlock():(e&&!o||null!=s)&&this._lock(),this.context.onCommit(i,t)}_discard(){this._input&&(this.field.inputValue=null,this.context.onDiscard(this._input))}_lock(){const{field:t}=this,e=this._parseNumber(t.inputValue),i=null!=e?t.createQuantity(e,this.context):null;t.lock(i)}_parseNumber(t){if(null==t)return null;const e=parseFloat(t);return isNaN(e)||!isFinite(e)?null:e}_toString(t){return null!=t?t.toFixed(2):_}};t([n()],d.prototype,"field",void 0),t([n()],d.prototype,"context",void 0),t([n()],d.prototype,"mode",void 0),t([n()],d.prototype,"_initialValue",null),t([n()],d.prototype,"_formattedValue",null),t([n()],d.prototype,"_input",void 0),t([n()],d.prototype,"_rawDisplayValue",null),t([n()],d.prototype,"_suffix",null),t([n()],d.prototype,"_title",null),d=t([o("esri.views.interactive.tooltip.components.TooltipEditableField")],d);const _="â€”";export{d as TooltipEditableField};
