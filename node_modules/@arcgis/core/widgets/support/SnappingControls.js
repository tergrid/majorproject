/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{isSome as t}from"../../core/arrayUtils.js";import{destroyMaybe as i}from"../../core/maybe.js";import{generateUID as s}from"../../core/uid.js";import{property as l}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import o from"../Widget.js";import{loadCalciteComponents as a}from"./componentsUtils.js";import{globalCss as r}from"./globalCss.js";import{loadLabeledSwitchComponents as c,LabeledSwitch as d}from"./LabeledSwitch.js";import{legacyIcon as p}from"./legacyIcon.js";import"./widgetUtils.js";import{messageBundle as g}from"./decorators/messageBundle.js";import{tsx as h}from"./jsxFactory.js";import m from"./SnappingControls/SnappingControlsViewModel.js";import u from"./SnappingControls/VisibleElements.js";const y="esri-snapping-controls",b={base:y,widgetIcon:p.vertexGps,container:`${y}__container`,item:`${y}__item`,toggleBlock:`${y}__toggle-block`,layerListBlock:`${y}__layer-list-block`,layerList:`${y}__layer-list`,layerListFilter:`${y}__layer-list__filter`,layerListButton:`${y}__layer-list__button`,layerListItem:`${y}__layer-list__item`,layerListGroup:`${y}__layer-list__group`,nestedContainer:`${y}__nested-container`},_={checked:"check-square-f",unchecked:"square",indeterminate:"minus-square"};let L=class extends o{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this.iconClass=b.widgetIcon,this.icon=null,this.layerListOpen=!0,this.messages=null,this.visibleElements=new u,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),requestAnimationFrame((()=>e.target.setFocus()))};const{snappingOptions:i,view:s,viewModel:l}=e;this.viewModel=l??(this._defaultViewModel=new m({snappingOptions:i,view:s}))}normalizeCtorArgs(e){const{snappingOptions:t,view:i,viewModel:s,...l}=e;return l}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=i(this._defaultViewModel))}loadDependencies(){return Promise.all([a({accordion:()=>import("@esri/calcite-components/dist/components/calcite-accordion.js"),"accordion-item":()=>import("@esri/calcite-components/dist/components/calcite-accordion-item.js"),action:()=>import("@esri/calcite-components/dist/components/calcite-action.js"),block:()=>import("@esri/calcite-components/dist/components/calcite-block.js"),button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon.js"),input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),list:()=>import("@esri/calcite-components/dist/components/calcite-list.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js")}),c()])}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=i(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return h("div",{"aria-label":e,class:this.classes(b.base,r.widget)},h("div",{class:b.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList()]}_renderToggles(){const{visibleElements:e}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null].filter(t),s=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?h("div",{class:b.nestedContainer},i):null].filter(t);return 0===s.length?null:h("calcite-block",{class:b.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",open:!0},s)}_renderEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:i}=t;return h(d,{checked:i.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:e.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:i}=t,s=i.enabled&&i.selfEnabled;return h(d,{checked:s,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:e.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:i}=t,s=i.enabled&&i.featureEnabled;return h(d,{checked:s,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:e.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,i=({target:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")},s=t.layerListViewModel.operationalItems.length>9?h("calcite-input",{class:b.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:i}):null,l=this._secondaryElementsDisabled,n=this.layerListOpen&&!l;return h("calcite-block",{class:b.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:n,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},s,this._renderToggleLayersButton(),h("calcite-list",{class:b.layerList},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems,this._layerListFilter)))}_renderLayerListItemCollection(e,i){return e.map((e=>{if(!i||this._itemTitleMatchesFilter(e,i))return e.children.length>0?this._renderLayerListItemGroup(e):this._renderLayerListItem(e);const t=e.children.filter((e=>this._itemTitleMatchesFilter(e,i)));return t.length>0?this._renderLayerListItemGroup(e,t):null})).toArray().filter(t)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,i=e?t.disableAllLayers:t.enableAllLayers;return h("calcite-button",{appearance:"transparent",class:b.layerListButton,label:i,name:"layer-toggle",onclick:this._onToggleLayersButtonClick,scale:"m"},i)}_renderLayerListItem(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,s=e.enabled,l=()=>{this._handleLayerListItemChange({checked:!s,value:e.layer.id})};return h("calcite-list-item",{class:b.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:i,onCalciteListItemSelect:l},h("calcite-icon",{icon:s?_.checked:_.unchecked,scale:"s",slot:"content-start"}))}_renderLayerListItemGroup(e,t){const{allChildrenEnabled:i,children:l,hasChildrenEnabled:n,title:o}=e,a=this.messages,r=o||a.untitledLayer,c=o&&""!==o?o:s(),d=!!t,p=t??l,g=i?_.checked:n?_.indeterminate:_.unchecked,m=i?a.disableAllLayers:a.enableAllLayers,u=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,!i)};return h("calcite-list-item",{class:b.layerListItem,key:c},h("calcite-accordion",{appearance:"transparent",class:b.layerListGroup},h("calcite-accordion-item",{expanded:d,heading:r,key:e.uid},h("calcite-action",{onclick:u,scale:"m",slot:"actions-start",text:m,textEnabled:!1},h("calcite-icon",{icon:g,scale:"s"})),h("calcite-list",null,this._renderLayerListItemCollection(p)))))}_itemTitleMatchesFilter(e,t){return null!=t&&t.test(e.title)}async _handleLayerListItemChange(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};e([l()],L.prototype,"_defaultViewModel",void 0),e([l()],L.prototype,"_layerListFilter",void 0),e([l()],L.prototype,"iconClass",void 0),e([l()],L.prototype,"icon",void 0),e([l()],L.prototype,"label",null),e([l({type:Boolean,nonNullable:!0})],L.prototype,"layerListOpen",void 0),e([l(),g("esri/widgets/support/SnappingControls/t9n/SnappingControls")],L.prototype,"messages",void 0),e([l()],L.prototype,"snappingOptions",null),e([l()],L.prototype,"view",null),e([l()],L.prototype,"viewModel",null),e([l({type:u,nonNullable:!0})],L.prototype,"visibleElements",void 0),e([l()],L.prototype,"_enabledToggleDisabled",null),e([l()],L.prototype,"_secondaryElementsDisabled",null),L=e([n("esri.widgets.support.SnappingControls")],L);const w=L;export{w as default};
