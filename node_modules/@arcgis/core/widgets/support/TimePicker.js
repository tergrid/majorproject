/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.29/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../intl.js";import{property as e}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/RandomLCG.js";import{subclass as i}from"../../core/accessorSupport/decorators/subclass.js";import s from"../Widget.js";import{globalCss as r}from"./globalCss.js";import o from"./TimePickerViewModel.js";import"./widgetUtils.js";import{messageBundle as a}from"./decorators/messageBundle.js";import{tsx as n}from"./jsxFactory.js";import{DateTime as m}from"luxon";import{getLocale as l}from"../../intl/locale.js";import{formatDate as h}from"../../intl/date.js";const u="esri-time-picker",c={base:u,timePicker:`${u}__date-picker`,timePickerInput:`${u}__input`},p="t",d=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"]);function _(t,e){return null!=t&&h(t.valueOf(),e).includes(" ")}let v=class extends s{constructor(t,e){super(t,e),this._activePart=null,this._activeTime=null,this.messages=null,this.timeZone=null,this.timeZoneName=null,this.viewModel=new o}get _dateTimeFormatOptions(){return{hour:"numeric",minute:"numeric",timeZone:this.timeZone??void 0,timeZoneName:this.timeZoneName??void 0}}get _dateTimeOptions(){return{locale:l(),numberingSystem:"latn",zone:this.timeZone||void 0}}get value(){return this.viewModel.value}set value(t){this.viewModel.value=t}render(){const t=this._activeTime||this.viewModel.value;return n("div",{class:this.classes(c.base,r.widget)},n("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(c.timePickerInput,r.input),onblur:this._handleInputBlur,onclick:this._handleInputClick,onfocus:this._handleInputFocus,oninput:this._handleInputKeydown,onkeydown:this._handleInputKeydown,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:h(t.valueOf(),this._dateTimeFormatOptions)}))}_handleInputBlur(){this._activeTime?.isValid&&(this.viewModel.value=this._activeTime.toJSDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(t){this._selectPart(t,this._activePart)}_selectPart(t,e){const i=this._activeTime;if(!i||!t)return;const s=h(i.valueOf(),this._dateTimeFormatOptions),r=0,o=s.indexOf(":");if("hours"===e)return void t.setSelectionRange(r,o);const a=o+1,n=a+2;if("minutes"===e)return void t.setSelectionRange(a,n);const m=n+1,l=s.length;"meridiem"!==e||t.setSelectionRange(m,l)}_handleInputFocus(t){this._activePart="hours",this._activeTime=m.fromJSDate(this.viewModel.value,{zone:this.timeZone||void 0}).startOf("minute"),this._selectPart(t.target,"hours")}_caretIndexToPartName(t){const e=this._activeTime?.toFormat(p,{locale:l(),numberingSystem:"latn"});if(!e)return null;const i=e.indexOf(":"),s=e.indexOf(" ");return t<=i?"hours":t>i&&t<=s?"minutes":"meridiem"}_handleInputKeydown(t){const{key:e,ctrlKey:i,metaKey:s,shiftKey:r}=t,o=this._activeTime,a=this._activePart,n=/\d/.test(e),m=/^a|p$/i.test(e),l=s||i;if((d.has(e)||n||"meridiem"===a&&m&&!l)&&null!=o){if("ArrowLeft"===e)this._activePart=this._prevPart();else if("ArrowRight"===e)this._activePart=this._nextPart();else if("Tab"===e){const t=r?this._prevPart():this._nextPart();if(t===this._activePart)return;this._activePart=t}else if("ArrowUp"===e)this._shift("up",a);else if("ArrowDown"===e)this._shift("down",a);else if(n)this._setTime(o,a,Number(e));else if(m){const t=e.toLowerCase(),i=o.hour;("a"===t&&i>=12||"p"===t&&i<12)&&this._shift("up",a)}t.preventDefault(),t.stopImmediatePropagation()}else l||(t.preventDefault(),t.stopImmediatePropagation())}_handleInputClick(t){const e=t.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(e.selectionStart??0)}_getOrderedParts(){return _(this._activeTime,this._dateTimeFormatOptions)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const t=this._getOrderedParts(),e=this._activePart?t.indexOf(this._activePart)-1:0;return t[Math.max(e,0)]}_nextPart(){const t=this._getOrderedParts(),e=this._activePart?t.indexOf(this._activePart)+1:0;return t[Math.min(e,t.length-1)]}_setTime(t,e,i){if("hours"===e){const e=_(t,this._dateTimeFormatOptions)?12:24,s=""+t.hour%e,r=i,o=Number(`${s}${i}`);2===s.length||o>e?this._activeTime=t.set({hour:r}):o<=e&&(this._activeTime=t.set({hour:o}))}else if("minutes"===e){const e=59,s=`${t.minute}`,r=i,o=Number(`${s}${i}`);2===s.length||o>e?this._activeTime=t.set({minute:r}):o<e&&(this._activeTime=t.set({minute:o}))}}_parseTime(t){if(!t)return null;let e=m.fromFormat(t,p,this._dateTimeOptions);return e.isValid?e:(e=m.fromISO(t,this._dateTimeOptions),e.isValid?e:(e=m.fromRFC2822(t,this._dateTimeOptions),e.isValid?e:(e=m.fromJSDate(new Date(t),this._dateTimeOptions),e.isValid?e:null)))}_handleInputPaste(t){const e=t.clipboardData?.getData("text/plain"),i=this._parseTime(e);i&&(this._activeTime=i),t.preventDefault(),t.stopImmediatePropagation()}_handleInputWheel(t){const e=t.deltaY<0?"up":"down";this._shift(e,this._activePart)}_shift(t,e){if(!e)return;const i="up"===t?"plus":"minus",s="meridiem"===e?12:1,r="hours"===e?"hour":"minutes"===e?"minute":"hours";this._activeTime=this._activeTime?.[i]({[r]:s})??null}};t([e()],v.prototype,"_dateTimeFormatOptions",null),t([e()],v.prototype,"_dateTimeOptions",null),t([e(),a("esri/widgets/support/t9n/TimePicker")],v.prototype,"messages",void 0),t([e()],v.prototype,"timeZone",void 0),t([e()],v.prototype,"timeZoneName",void 0),t([e()],v.prototype,"value",null),t([e({type:o})],v.prototype,"viewModel",void 0),v=t([i("esri.widgets.support.TimePicker")],v);const f=v;export{f as default};
